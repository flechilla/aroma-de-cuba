---
import { Image } from 'astro:assets';

interface GalleryImage {
  src: ImageMetadata;
  alt: string;
  caption?: string;
}

interface Props {
  images: GalleryImage[];
  columns?: 2 | 3 | 4;
}

const { images, columns = 3 } = Astro.props;

const gridCols: Record<number, string> = {
  2: 'grid-cols-1 sm:grid-cols-2',
  3: 'grid-cols-1 sm:grid-cols-2 lg:grid-cols-3',
  4: 'grid-cols-1 sm:grid-cols-2 lg:grid-cols-4',
};
---

<div class={`grid ${gridCols[columns]} gap-4 my-8`}>
  {images.map((img, i) => (
    <figure class="group relative overflow-hidden rounded-lg cursor-pointer" data-gallery-item={i}>
      <Image
        src={img.src}
        alt={img.alt}
        width={600}
        height={400}
        class="w-full h-auto object-cover transition-transform duration-300 group-hover:scale-105"
        loading="lazy"
      />
      {img.caption && (
        <figcaption class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-humo/80 to-transparent px-4 py-3 text-sm text-blanco translate-y-full group-hover:translate-y-0 transition-transform duration-300">
          {img.caption}
        </figcaption>
      )}
    </figure>
  ))}
</div>

<!-- Lightbox overlay -->
<div id="lightbox" class="fixed inset-0 z-[300] hidden bg-humo/90 flex items-center justify-center" data-lightbox>
  <button class="absolute top-4 right-4 text-blanco text-3xl bg-transparent border-none cursor-pointer hover:text-arena" data-lightbox-close aria-label="Close">&times;</button>
  <img id="lightbox-img" class="max-w-[90vw] max-h-[85vh] rounded-lg object-contain" src="" alt="" />
</div>

<script>
  const lightbox = document.querySelector('[data-lightbox]');
  const lightboxImg = document.getElementById('lightbox-img') as HTMLImageElement;
  const closeBtn = document.querySelector('[data-lightbox-close]');

  document.querySelectorAll('[data-gallery-item]').forEach((item) => {
    item.addEventListener('click', () => {
      const img = item.querySelector('img');
      if (img && lightboxImg && lightbox) {
        lightboxImg.src = img.src;
        lightboxImg.alt = img.alt;
        lightbox.classList.remove('hidden');
      }
    });
  });

  function closeLightbox() {
    lightbox?.classList.add('hidden');
  }

  closeBtn?.addEventListener('click', closeLightbox);
  lightbox?.addEventListener('click', (e) => {
    if (e.target === lightbox) closeLightbox();
  });
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') closeLightbox();
  });
</script>
