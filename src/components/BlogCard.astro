---
import { Image } from 'astro:assets';
import CategoryBadge from './CategoryBadge.astro';
import { getDateLocale, getLocalizedPath } from '../i18n/utils';

interface Props {
  title: string;
  description: string;
  date: Date;
  category: string;
  coverImage: ImageMetadata;
  coverImageAlt: string;
  slug: string;
  featured?: boolean;
  lang?: 'es' | 'en';
  readingTime?: number;
}

const {
  title,
  description,
  date,
  category,
  coverImage,
  coverImageAlt,
  slug,
  featured = false,
  lang = 'es',
  readingTime,
} = Astro.props;

const formattedDate = new Intl.DateTimeFormat(getDateLocale(lang), {
  year: 'numeric',
  month: 'short',
  day: 'numeric',
}).format(date);

const href = getLocalizedPath(`blog/${slug}`, lang);
const readingLabel = lang === 'es' ? 'min de lectura' : 'min read';
---

<article class={`group bg-blanco border border-ceniza rounded-lg overflow-hidden shadow-[var(--shadow-warm-sm)] transition-all duration-250 hover:shadow-[var(--shadow-warm-md)] hover:-translate-y-0.5 ${featured ? '' : ''}`}>
  <a href={href} class={`no-underline text-inherit flex h-full ${featured ? 'flex-row max-md:flex-col' : 'flex-col'}`}>
    <div class={`overflow-hidden ${featured ? 'flex-[0_0_55%] max-md:aspect-video' : 'aspect-video'}`}>
      <Image
        src={coverImage}
        alt={coverImageAlt}
        width={featured ? 800 : 400}
        height={featured ? 420 : 225}
        class="w-full h-full object-cover transition-transform duration-250 group-hover:scale-[1.03]"
        loading="lazy"
      />
    </div>
    <div class="p-4 px-6 pb-6 flex-1 flex flex-col">
      <div class="flex items-center gap-3 mb-3 text-xs text-piedra">
        <CategoryBadge category={category} lang={lang} />
        <time datetime={date.toISOString()}>{formattedDate}</time>
        {readingTime && <span>{readingTime} {readingLabel}</span>}
      </div>
      <h3 class={`font-heading font-bold text-tabaco mb-2 leading-snug group-hover:text-coral transition-colors ${featured ? 'text-2xl' : 'text-xl'}`}>
        {title}
      </h3>
      <p class="text-sm text-piedra-oscura leading-relaxed flex-1">{description}</p>
    </div>
  </a>
</article>
