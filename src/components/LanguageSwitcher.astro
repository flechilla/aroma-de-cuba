---
import { getLangFromUrl } from '../i18n/utils';

const lang = getLangFromUrl(Astro.url);
const pathname = Astro.url.pathname;

function getAlternatePath(): string {
  if (lang === 'es') {
    if (pathname === '/') return '/en/';
    if (pathname === '/historia' || pathname === '/historia/') return '/en/history';
    if (pathname === '/cultura' || pathname === '/cultura/') return '/en/culture';
    if (pathname === '/turismo' || pathname === '/turismo/') return '/en/tourism';
    if (pathname === '/gastronomia' || pathname === '/gastronomia/') return '/en/gastronomy';
    if (pathname === '/productos' || pathname === '/productos/') return '/en/products';
    // Category archives: /blog/categoria/X → /en/blog/category/X
    const catMatch = pathname.match(/^\/blog\/categoria\/(.+)/);
    if (catMatch) return `/en/blog/category/${catMatch[1]}`;
    // Tag archives: /blog/etiqueta/X → /en/blog/tag/X
    const tagMatch = pathname.match(/^\/blog\/etiqueta\/(.+)/);
    if (tagMatch) return `/en/blog/tag/${tagMatch[1]}`;
    return `/en${pathname}`;
  } else {
    const withoutPrefix = pathname.replace(/^\/en/, '');
    if (withoutPrefix === '/' || withoutPrefix === '') return '/';
    if (withoutPrefix === '/history' || withoutPrefix === '/history/') return '/historia';
    if (withoutPrefix === '/culture' || withoutPrefix === '/culture/') return '/cultura';
    if (withoutPrefix === '/tourism' || withoutPrefix === '/tourism/') return '/turismo';
    if (withoutPrefix === '/gastronomy' || withoutPrefix === '/gastronomy/') return '/gastronomia';
    if (withoutPrefix === '/products' || withoutPrefix === '/products/') return '/productos';
    // Category archives: /blog/category/X → /blog/categoria/X
    const catMatch = withoutPrefix.match(/^\/blog\/category\/(.+)/);
    if (catMatch) return `/blog/categoria/${catMatch[1]}`;
    // Tag archives: /blog/tag/X → /blog/etiqueta/X
    const tagMatch = withoutPrefix.match(/^\/blog\/tag\/(.+)/);
    if (tagMatch) return `/blog/etiqueta/${tagMatch[1]}`;
    return withoutPrefix || '/';
  }
}

const alternatePath = getAlternatePath();
const alternateLabel = lang === 'es' ? 'EN' : 'ES';
const currentLabel = lang === 'es' ? 'ES' : 'EN';
---

<div class="flex items-center gap-1 font-body text-sm font-medium">
  <span class="text-coral font-semibold" aria-current="true">{currentLabel}</span>
  <span class="text-piedra" aria-hidden="true">|</span>
  <a href={alternatePath} class="text-piedra-oscura no-underline px-2 py-1 rounded transition-colors hover:text-tabaco hover:bg-arena">
    {alternateLabel}
  </a>
</div>
